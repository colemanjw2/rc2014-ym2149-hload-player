
# RC2014 YM2149 Tune Build Workflow (HLOAD / BASIC)

This repository contains a **RAM-resident YM2149 (AY-3-8910) music player**
for the RC2014 Z80 system, built for **BASIC + HLOAD** workflows (not CP/M).

This README documents the **actual development workflow used here**, not
the original RomWBW/CPM-centric one.

---

## System assumptions

- RC2014 Z80 system
- YM2149 sound card (own crystal)
- BASIC ROM with `HLOAD`
- Programs loaded into RAM (not ROM)
- Intel HEX (`.ihx`) used for transfer
- CPU clock: **3.6864 MHz**
- Serial speed: conservative / reliable (e.g. 57600 or slower)

---

## One-time source setup

### `PTxPlay.asm`
The player source **must** contain:

```asm
include "tune.inc"
````

This is the *only* permanent edit required.

---

### `tune.inc`

This file is auto-generated by the build script and contains exactly one line:

```asm
    incbin "tunes/altitude.pt3"
```

You never edit this by hand.

---

## Required tools (host)

* `sjasmplus`
* `z88dk-appmake`
* POSIX shell environment

Verify:

```bash
sjasmplus --version
z88dk-appmake --version
```

---

## Directory layout

```
player/
├── PTxPlay.asm
├── tune.inc            # auto-written by script
├── build_tune_ihx.sh   # main workflow command
├── tunes/
│   ├── altitude.pt3
│   └── example.pt2
└── build/
    ├── altitude.bin
    └── altitude.ihx
```

---

## Daily workflow (TL;DR)

### 1. Add a tune

Copy `.pt2` or `.pt3` files into:

```
tunes/
```

---

### 2. Build a tune

From the `player/` directory:

```bash
./build_tune_ihx.sh altitude.pt3
```

or

```bash
./build_tune_ihx.sh tunes/altitude.pt3
```

---

### 3. Output

The final file you care about:

```
build/altitude.ihx
```

This is an **Intel HEX (IHX)** file suitable for BASIC `HLOAD`.

---

### 4. Load on RC2014

On the RC2014:

```basic
HLOAD
```

Send `build/altitude.ihx` over serial using your preferred method
(VS Code task, `pv`, minicom text send, etc).

---

## What the script actually does

1. Resolves the `.pt2/.pt3` file
2. Writes `tune.inc` with the correct `incbin`
3. Assembles `PTxPlay.asm` → raw Z80 binary
4. Converts binary → Intel HEX at `ORG=0xC000`
5. Outputs:

   * `build/<tune>.bin`
   * `build/<tune>.ihx`

`PTxPlay.asm` is never modified.

---

## Optional environment variables

Override load address:

```bash
ORG=49152 ./build_tune_ihx.sh altitude.pt3
```

Copy output somewhere convenient:

```bash
OUTDIR=~/RC2014/Development\ Resources/Soundcard\ Tunes \
./build_tune_ihx.sh altitude.pt3
```

---

## Timing note

Playback timing is software-controlled in `PTxPlay.asm` and has been tuned
for a **3.6864 MHz CPU clock**.

If CPU frequency changes, retune the delay constant in the `pause` routine.

---

## Design philosophy

* Stable source
* No manual edits between builds
* BASIC-first workflow
* RAM-resident execution
* Deterministic, debuggable pipeline

---

## Mental model

```
PT3 → tune.inc → ASM → BIN → IHX → HLOAD
```

One command in, one `.ihx` out.

````

